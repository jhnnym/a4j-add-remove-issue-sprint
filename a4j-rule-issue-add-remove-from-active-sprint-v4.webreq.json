{"rules":[{"id":39,"clientKey":"com.codebarrel.tenant.global","name":"Issue Added/Removed from Active Sprint (v4)","state":"ENABLED","description":"Send a notification when an issue is added or removed from an active sprint.\n\nPremise\na. This has not been tested with parallel sprints enabled\nb. There can be only one sprint change per rule triggered.  \nc. The UI and REST API allow only one sprint change per issue update.\nd. Tested using Jira 8.20.10 and A4J 9.0.3 with limited scenarios\ne. An issue's sprint field can have multiple closed (completed) and (zero or one active or future) sprints.\n\n\nScenario:\n\nSprints ID.      state\n----------------+---------------\n1                      completed\n3                      future\n4                      active\n5                      completed \n\n1. simple active\n  EMPTY -> 4          >>> send notification that issue has been added to 4\n  4.    -> EMPTY      >>> send notification that issue has been removed from 4\n\n2. simple  active,closed\n\n  1     -> 1,4        >>> send notification that issue has been added to 4\n  1,4   -> 1          >>> send notification that issue has been removed from 4\n\n3. simple  active, 2x closed\n\n  1,5   -> 1,4,5      >>> send notification that issue has been added to 4\n  1,4,5 -> 1,5        >>> send notification that issue has been removed from 4\n\n4. simple future (no notifications)\n\n  EMPTY -> 3          >>> no notification \n  3     -> EMPTY      >>> no notification \n\n5. simple future,closed\n\n  1     -> 1,3        >>> no notification\n  1,3   -> 1          >>> no notification\n\n6. simple future, 2x closed\n\n  1,5   -> 1,3,5      >>> no notification\n  1,3,5 -> 1,5        >>> no notification\n\n7. move between future and active:\n  1,3 -> 1,4          >>> send notification that issue has been added to 4\n  1,4 -> 1,3          >>> send notification that issue has been removed from 4\n  1,3,5 -> 1,4,5      >>> send notification that issue has been added to 4\n  1,4,5 -> 1,3,5      >>> send notification that issue has been removed from 4\n\n-----------------------------------\n\nCan add these to check my variable values in a notification action prior the main IF block:\n\nTEST My variables\n\nissue.key = {{issue.key}}\nfieldChange {{fieldChange}}\n===============\nanchor = {{anchor}}\nfrom.List = {{fromList}}\nfromListSize = {{fromListSize}}\nfromListSum = {{fromListSum}}\ntoList = {{toList}} \ntoListSize={{toListSize}}\ntoListSum = {{toListSum}}\n-------\nmergedSprintsString = {{mergedSprintsString}}\nmergedSprintsList = {{{{mergedSprintsString.split(',').distinct}}\nmergedListSprintsSum = {{mergedSprintsListSum}}\npreviousSprintID = {{previousSprintID}}\ncurrentSprintID = {{currentSprintID}}\n--------\ncheckAdd = {{checkAdd}}.  \ncheckRemove = {{checkRemove}}\n\n-------------------------\n\nif checkAdd >= 0 {\n   if new sprint is active {\n      send notification\n   }\n}\n\nif checkRemove >= 0 {\n   if new sprint is active {\n      send notification\n   }\n}\n\n-----------------------------------\n\nselect \"ID\", \"NAME\", \"STARTED\", \"CLOSED\" from \"AO_60DB71_SPRINT\" order by \"ID\";\n ID |           NAME           | STARTED | CLOSED \n----+--------------------------+---------+--------\n  1 | Nov-2023                 | t       | t\n  2 | Sample Sprint 1          | t       | t\n  3 | FutureSprint             | f       | f\n  4 | ActiveSprint             | t       | f\n  5 | short sprint Dec 11 only | t       | t\n(5 rows)\n\nclosed sprint = STARTED && CLOSED\nopen sprint   = STARTED && !CLOSED\nfuture sprint = !STARTED && !CLOSED\n\n---------------\n\n% curl -s -u username:password -X GET \"http://localhost:42010/j82010/rest/api/latest/issue/SP-32\" | python3 -mjson.tool | grep -B1 \"com.atlassian.greenhopper.service.sprint.Sprint\"\n\n\"customfield_10106\": [        \n\n\"com.atlassian.greenhopper.service.sprint.Sprint@3478edbe[id=1,rapidViewId=1,state=CLOSED,name=Nov-2023,startDate=2023-11-01T01:18:00.000-07:00,endDate=2023-11-30T01:38:00.000-08:00,completeDate=2023-12-08T14:36:44.069-08:00,activatedDate=2023-02-03T01:18:22.593-08:00,sequence=1,goal=<null>,autoStartStop=false]\", \n\n\"com.atlassian.greenhopper.service.sprint.Sprint@5255fc4c[id=4,rapidViewId=8,state=ACTIVE,name=ActiveSprint,startDate=2023-12-01T19:33:00.000-08:00,endDate=2023-12-31T19:33:00.000-08:00,completeDate=<null>,activatedDate=2023-12-06T19:45:01.005-08:00,sequence=4,goal=Dec-2023 ,autoStartStop=false]\", \n\n\"com.atlassian.greenhopper.service.sprint.Sprint@68447f13[id=5,rapidViewId=8,state=CLOSED,name=short sprint Dec 11 only,startDate=2023-12-11T03:48:00.000-08:00,endDate=2023-12-11T16:00:00.000-08:00,completeDate=2023-12-11T16:00:05.489-08:00,activatedDate=2023-12-11T15:56:42.006-08:00,sequence=5,goal=,autoStartStop=false]\"","canOtherRuleTrigger":false,"notifyOnError":"NEVER","authorAccountId":"JIRAUSER10000","actorAccountId":"JIRAUSER10000","created":1702487161767,"updated":1702490122370,"trigger":{"id":"5563","component":"TRIGGER","schemaVersion":2,"type":"jira.issue.field.changed","value":{"synchronous":false,"fields":[{"value":"customfield_10106","type":"field"}],"actions":[]},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},"components":[{"id":"5564","component":"ACTION","schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702452982311","name":{"type":"FREE","value":"anchor"},"type":"SMART","query":{"type":"SMART","value":"0,"},"lazy":false},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5565","component":"ACTION","schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702449582115","name":{"type":"FREE","value":"fromList"},"type":"SMART","query":{"type":"SMART","value":"{{anchor.concat(fieldChange.from).split(',')}}"},"lazy":false},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5566","component":"ACTION","schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702465879402","name":{"type":"FREE","value":"fromListSize"},"type":"SMART","query":{"type":"SMART","value":"{{#=}}{{anchor.concat(fieldChange.from).split(',').size}}{{/}}"},"lazy":false},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5567","component":"ACTION","schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702372354065","name":{"type":"FREE","value":"fromListSum"},"type":"SMART","query":{"type":"SMART","value":"{{anchor.concat(fieldChange.from).split(',').sum.floor}}"},"lazy":false},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5568","component":"ACTION","schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702449665257","name":{"type":"FREE","value":"toList"},"type":"SMART","query":{"type":"SMART","value":"{{anchor.concat(fieldChange.to).split(',')}}"},"lazy":false},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5569","component":"ACTION","schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702465911403","name":{"type":"FREE","value":"toListSize"},"type":"SMART","query":{"type":"SMART","value":"{{#=}}{{anchor.concat(fieldChange.to).split(',').size}}{{/}}"},"lazy":false},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5570","component":"ACTION","schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702372391432","name":{"type":"FREE","value":"toListSum"},"type":"SMART","query":{"type":"SMART","value":"{{anchor.concat(fieldChange.to).split(',').sum.floor}}"},"lazy":false},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5571","component":"ACTION","schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702434584284","name":{"type":"FREE","value":"mergedSprintsString"},"type":"SMART","query":{"type":"SMART","value":"{{anchor.concat(fieldChange.from).concat(\",\").concat(anchor.concat(fieldChange.to)).remove(\" \")}}"},"lazy":false},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5572","component":"ACTION","schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702442284171","name":{"type":"FREE","value":"mergedSprintsListSum"},"type":"SMART","query":{"type":"SMART","value":"{{mergedSprintsString.split(',').distinct.sum}}"},"lazy":false},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5573","component":"ACTION","schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702455209130","name":{"type":"FREE","value":"previousSprintID"},"type":"SMART","query":{"type":"SMART","value":"{{#=}}{{mergedSprintsListSum}}-{{toListSum}}{{/}}"},"lazy":false},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5574","component":"ACTION","schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702455348543","name":{"type":"FREE","value":"currentSprintID"},"type":"SMART","query":{"type":"SMART","value":"{{#=}}{{mergedSprintsListSum}}-{{fromListSum}}{{/}}"},"lazy":false},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5575","component":"ACTION","schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702463652061","name":{"type":"FREE","value":"checkAdd"},"type":"SMART","query":{"type":"SMART","value":"{{#=}}{{toListSize}}-{{fromListSize}}{{/}}"},"lazy":false},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5576","component":"ACTION","schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702463716250","name":{"type":"FREE","value":"checkRemove"},"type":"SMART","query":{"type":"SMART","value":"{{#=}}{{fromListSize}}-{{toListSize}}{{/}}"},"lazy":false},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5577","component":"ACTION","schemaVersion":2,"type":"jira.issue.outgoing.webhook","value":{"url":"https://webhook.site/87d69382-8c6e-4877-8056-0297c8089e88","headers":[{"id":"_header_1702288366811","name":"","value":{"keyOrValue":"","secret":false}}],"sendIssue":false,"contentType":"custom","customBody":"TEST My variables\n\nissue.key = {{issue.key}}\nfieldChange {{fieldChange}}\n===============\nanchor = {{anchor}}\nfrom.List = {{fromList}}\nfromListSize = {{fromListSize}}\nfromListSum = {{fromListSum}}\ntoList = {{toList}} \ntoListSize={{toListSize}}\ntoListSum = {{toListSum}}\n-------\nmergedSprintsString = {{mergedSprintsString}}\nmergedSprintsList = {{mergedSprintsString.split(',').distinct}}\nmergedListSprintsSum = {{mergedSprintsListSum}}\npreviousSprintID = {{previousSprintID}}\ncurrentSprintID = {{currentSprintID}}\n--------\ncheckAdd = {{checkAdd}}.  \ncheckRemove = {{checkRemove}}\n\n-------------------------\nNotes:\n\nif checkAdd >= 0 {\n   if new sprint is active {\n      send notification\n   }\n}\n\nif checkRemove >= 0 {\n   if new sprint is active {\n      send notification\n   }\n}\n\n","method":"POST","responseEnabled":false,"usedSecretsKeys":[]},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5578","component":"BRANCH","schemaVersion":1,"type":"jira.issue.related","value":{"relatedType":"current","jql":"","linkTypes":[],"onlyUpdatedIssues":false,"processIssuesInBulk":false},"children":[{"id":"5579","component":"CONDITION","parentId":"5578","schemaVersion":1,"type":"jira.comparator.condition","value":{"first":"{{checkAdd}}","second":"-1","operator":"GREATER_THAN"},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5580","component":"ACTION","parentId":"5578","schemaVersion":2,"type":"jira.issue.outgoing.webhook","value":{"url":"http://localhost:42010/j82010/rest/agile/1.0/sprint/{{currentSprintID}}","headers":[{"id":"_header_1701949243211","name":"Authorization","value":{"keyOrValue":"Bearer MTE0NTk5MjM5MTM1Ohg2tih+m5cX3gW0IGMh+sFxp0Hc","secret":false}}],"sendIssue":false,"contentType":"empty","method":"GET","responseEnabled":true,"usedSecretsKeys":[]},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5581","component":"ACTION","parentId":"5578","schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702251014615","name":{"type":"FREE","value":"currentSprintState"},"type":"SMART","query":{"type":"SMART","value":"{{webhookResponse.body.state}}"},"lazy":false},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5582","component":"CONDITION","parentId":"5578","schemaVersion":1,"type":"jira.comparator.condition","value":{"first":"{{currentSprintState}}","second":"active","operator":"EQUALS"},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5583","component":"ACTION","parentId":"5578","schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702469748807","name":{"type":"FREE","value":"sprintName"},"type":"SMART","query":{"type":"SMART","value":"{{webhookResponse.body.name}}"},"lazy":false},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5584","component":"ACTION","parentId":"5578","schemaVersion":2,"type":"jira.issue.outgoing.webhook","value":{"url":"https://webhook.site/87d69382-8c6e-4877-8056-0297c8089e88","headers":[{"id":"_header_1701917180984","name":"Authorization","value":{"keyOrValue":"Bearer x","secret":false}}],"sendIssue":false,"contentType":"custom","customBody":"{{now .convertToTimeZone(\"America/Los_Angeles\").longDateTime}}:\nAdded {{issue.key}} to active sprint '{{sprintName}}'\n\nOld Issue Sprint: '[{{fieldChange.fromString}}]'\nNew Issue Sprint: '[{{fieldChange.toString}}]'\n","method":"POST","responseEnabled":false,"usedSecretsKeys":[]},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false}],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5585","component":"CONDITION","schemaVersion":1,"type":"jira.condition.container.block","children":[{"id":"5586","component":"CONDITION_BLOCK","parentId":"5585","schemaVersion":1,"type":"jira.condition.if.block","value":{"conditionMatchType":"ALL"},"children":[{"id":"5588","component":"ACTION","parentId":"5586","schemaVersion":2,"type":"jira.issue.outgoing.webhook","value":{"url":"http://localhost:42010/j82010/rest/agile/1.0/sprint/{{previousSprintID}}","headers":[{"id":"_header_1701946642254","name":"Authorization","value":{"keyOrValue":"Bearer MTE0NTk5MjM5MTM1Ohg2tih+m5cX3gW0IGMh+sFxp0Hc","secret":false}}],"sendIssue":false,"contentType":"empty","method":"GET","responseEnabled":true,"usedSecretsKeys":[]},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5589","component":"ACTION","parentId":"5586","schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1701947930023","name":{"type":"FREE","value":"previousSprintState"},"type":"SMART","query":{"type":"SMART","value":"{{webhookResponse.body.state}}"},"lazy":false},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5590","component":"CONDITION","parentId":"5586","schemaVersion":1,"type":"jira.comparator.condition","value":{"first":"{{previousSprintState}}","second":"active","operator":"EQUALS"},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5591","component":"ACTION","parentId":"5586","schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702469652306","name":{"type":"FREE","value":"sprintName"},"type":"SMART","query":{"type":"SMART","value":"{{webhookResponse.body.name}}"},"lazy":false},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false},{"id":"5592","component":"ACTION","parentId":"5586","schemaVersion":2,"type":"jira.issue.outgoing.webhook","value":{"url":"https://webhook.site/87d69382-8c6e-4877-8056-0297c8089e88","headers":[{"id":"_header_1701912785834","name":"","value":{"keyOrValue":"","secret":false}}],"sendIssue":false,"contentType":"custom","customBody":"{{now.convertToTimeZone(\"America/Los_Angeles\").longDateTime}}:\nRemoved issue {{issue.key}} from active sprint '{{sprintName}}'\n\nIssue Sprint:  '[{{issue.sprint}}]'\nfieldChange.to : '{{fieldChange.toString}}'\nfieldChange.from : '{{fieldChange.fromString}}'\nprevious sprint state: '{{previousSprintState}}'","method":"POST","responseEnabled":false,"usedSecretsKeys":[]},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false}],"conditions":[{"id":"5587","component":"CONDITION","conditionParentId":"5586","schemaVersion":1,"type":"jira.comparator.condition","value":{"first":"{{checkRemove}}","second":"-1","operator":"GREATER_THAN"},"children":[],"conditions":[],"optimisedIds":[],"newComponent":false}],"optimisedIds":[],"newComponent":false}],"conditions":[],"optimisedIds":[],"newComponent":false}],"projects":[],"labels":[],"tags":[]}],"cloud":false}