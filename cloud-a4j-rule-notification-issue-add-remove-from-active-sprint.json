{"cloud":true,"rules":[{"id":17203407,"clientKey":"a34b2254-4bdb-3129-80ae-4969d95c3851","name":"Issue Added/Removed from Active Sprint (Cloud)","state":"ENABLED","description":"Send a notification when an issue is added or removed from an active sprint.\n\nPremise\na. This has not been tested with parallel sprints enabled\nb. There can be only one sprint change per rule triggered.  \nc. The UI and REST API allow only one sprint change per issue update.\nd. Tested using Jira 8.20.10 and A4J 9.0.3 with limited scenarios\ne. An issue's sprint field can have multiple closed (completed) and (zero or one active or future) sprints.\n\n\nScenario:\n\nSprints ID.      state\n----------------+---------------\n1                      completed\n3                      future\n4                      active\n5                      completed \n\n1. simple active\n  EMPTY -> 4          >>> send notification that issue has been added to 4\n  4.    -> EMPTY      >>> send notification that issue has been removed from 4\n\n2. simple  active,closed\n\n  1     -> 1,4        >>> send notification that issue has been added to 4\n  1,4   -> 1          >>> send notification that issue has been removed from 4\n\n3. simple  active, 2x closed\n\n  1,5   -> 1,4,5      >>> send notification that issue has been added to 4\n  1,4,5 -> 1,5        >>> send notification that issue has been removed from 4\n\n4. simple future (no notifications)\n\n  EMPTY -> 3          >>> no notification \n  3     -> EMPTY      >>> no notification \n\n5. simple future,closed\n\n  1     -> 1,3        >>> no notification\n  1,3   -> 1          >>> no notification\n\n6. simple future, 2x closed\n\n  1,5   -> 1,3,5      >>> no notification\n  1,3,5 -> 1,5        >>> no notification\n\n7. move between future and active:\n  1,3 -> 1,4          >>> send notification that issue has been added to 4\n  1,4 -> 1,3          >>> send notification that issue has been removed from 4\n  1,3,5 -> 1,4,5      >>> send notification that issue has been added to 4\n  1,4,5 -> 1,3,5      >>> send notification that issue has been removed from 4\n\n-----------------------------------\n\nCan add these to check my variable values in a notification action prior to the main IF block:\n\nTEST My variables\n\nissue.key = {{issue.key}}\nfieldChange {{fieldChange}}\n===============\nanchor = {{anchor}}\nfrom.List = {{fromList}}\nfromListSize = {{fromListSize}}\nfromListSum = {{fromListSum}}\ntoList = {{toList}} \ntoListSize={{toListSize}}\ntoListSum = {{toListSum}}\n-------\nmergedSprintsString = {{mergedSprintsString}}\nmergedSprintsList = {{{{mergedSprintsString.split(',').distinct}}\nmergedListSprintsSum = {{mergedSprintsListSum}}\npreviousSprintID = {{previousSprintID}}\ncurrentSprintID = {{currentSprintID}}\n--------\ncheckAdd = {{checkAdd}}.  \ncheckRemove = {{checkRemove}}\n\n-------------------------\n\nif checkAdd >= 0 {\n   if new sprint is active {\n      send notification\n   }\n}\n\nif checkRemove >= 0 {\n   if new sprint is active {\n      send notification\n   }\n}\n\n-----------------------------------\n\nSample Data (from test Data Center environment):\n\nselect \"ID\", \"NAME\", \"STARTED\", \"CLOSED\" from \"AO_60DB71_SPRINT\" order by \"ID\";\n ID |           NAME           | STARTED | CLOSED \n----+--------------------------+---------+--------\n  1 | Nov-2023                 | t       | t\n  2 | Sample Sprint 1          | t       | t\n  3 | FutureSprint             | f       | f\n  4 | ActiveSprint             | t       | f\n  5 | short sprint Dec 11 only | t       | t\n(5 rows)\n\nclosed sprint = STARTED && CLOSED\nopen sprint   = STARTED && !CLOSED\nfuture sprint = !STARTED && !CLOSED\n\n---------------\n\n% curl -s -u username:password -X GET \"http://localhost:42010/j82010/rest/api/latest/issue/SP-32\" | python3 -mjson.tool | grep -B1 \"com.atlassian.greenhopper.service.sprint.Sprint\"\n\n\"customfield_10106\": [        \n\n\"com.atlassian.greenhopper.service.sprint.Sprint@3478edbe[id=1,rapidViewId=1,state=CLOSED,name=Nov-2023,startDate=2023-11-01T01:18:00.000-07:00,endDate=2023-11-30T01:38:00.000-08:00,completeDate=2023-12-08T14:36:44.069-08:00,activatedDate=2023-02-03T01:18:22.593-08:00,sequence=1,goal=<null>,autoStartStop=false]\", \n\n\"com.atlassian.greenhopper.service.sprint.Sprint@5255fc4c[id=4,rapidViewId=8,state=ACTIVE,name=ActiveSprint,startDate=2023-12-01T19:33:00.000-08:00,endDate=2023-12-31T19:33:00.000-08:00,completeDate=<null>,activatedDate=2023-12-06T19:45:01.005-08:00,sequence=4,goal=Dec-2023 ,autoStartStop=false]\", \n\n\"com.atlassian.greenhopper.service.sprint.Sprint@68447f13[id=5,rapidViewId=8,state=CLOSED,name=short sprint Dec 11 only,startDate=2023-12-11T03:48:00.000-08:00,endDate=2023-12-11T16:00:00.000-08:00,completeDate=2023-12-11T16:00:05.489-08:00,activatedDate=2023-12-11T15:56:42.006-08:00,sequence=5,goal=,autoStartStop=false]\"","authorAccountId":"5cdee6194326200dc9723dce","actor":{"type":"ACCOUNT_ID","value":"557058:f58131cb-b67d-43c7-b30d-6b58d40bd077"},"created":1704521545541,"updated":1704535957606,"trigger":{"id":"379623838","component":"TRIGGER","parentId":null,"conditionParentId":null,"schemaVersion":2,"type":"jira.issue.field.changed","value":{"changeType":"ANY_CHANGE","fields":[{"value":"Sprint","type":"fieldName"}],"actions":[]},"children":[],"conditions":[],"connectionId":null},"components":[{"id":"379623839","component":"ACTION","parentId":null,"conditionParentId":null,"schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702452982311","name":{"type":"FREE","value":"anchor"},"type":"SMART","query":{"type":"SMART","value":"0,"},"lazy":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623840","component":"ACTION","parentId":null,"conditionParentId":null,"schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702449582115","name":{"type":"FREE","value":"fromList"},"type":"SMART","query":{"type":"SMART","value":"{{anchor.concat(fieldChange.from).split(',')}}"},"lazy":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623841","component":"ACTION","parentId":null,"conditionParentId":null,"schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702465879402","name":{"type":"FREE","value":"fromListSize"},"type":"SMART","query":{"type":"SMART","value":"{{#=}}{{anchor.concat(fieldChange.from).split(',').size}}{{/}}"},"lazy":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623842","component":"ACTION","parentId":null,"conditionParentId":null,"schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702372354065","name":{"type":"FREE","value":"fromListSum"},"type":"SMART","query":{"type":"SMART","value":"{{anchor.concat(fieldChange.from).split(',').sum.floor}}"},"lazy":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623843","component":"ACTION","parentId":null,"conditionParentId":null,"schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702449665257","name":{"type":"FREE","value":"toList"},"type":"SMART","query":{"type":"SMART","value":"{{anchor.concat(fieldChange.to).split(',')}}"},"lazy":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623844","component":"ACTION","parentId":null,"conditionParentId":null,"schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702465911403","name":{"type":"FREE","value":"toListSize"},"type":"SMART","query":{"type":"SMART","value":"{{#=}}{{anchor.concat(fieldChange.to).split(',').size}}{{/}}"},"lazy":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623845","component":"ACTION","parentId":null,"conditionParentId":null,"schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702372391432","name":{"type":"FREE","value":"toListSum"},"type":"SMART","query":{"type":"SMART","value":"{{anchor.concat(fieldChange.to).split(',').sum.floor}}"},"lazy":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623846","component":"ACTION","parentId":null,"conditionParentId":null,"schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702434584284","name":{"type":"FREE","value":"mergedSprintsString"},"type":"SMART","query":{"type":"SMART","value":"{{anchor.concat(fieldChange.from).concat(\",\").concat(anchor.concat(fieldChange.to)).remove(\" \")}}"},"lazy":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623847","component":"ACTION","parentId":null,"conditionParentId":null,"schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702442284171","name":{"type":"FREE","value":"mergedSprintsListSum"},"type":"SMART","query":{"type":"SMART","value":"{{mergedSprintsString.split(',').distinct.sum}}"},"lazy":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623848","component":"ACTION","parentId":null,"conditionParentId":null,"schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702455209130","name":{"type":"FREE","value":"previousSprintID"},"type":"SMART","query":{"type":"SMART","value":"{{#=}}{{mergedSprintsListSum}}-{{toListSum}}{{/}}"},"lazy":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623849","component":"ACTION","parentId":null,"conditionParentId":null,"schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702455348543","name":{"type":"FREE","value":"currentSprintID"},"type":"SMART","query":{"type":"SMART","value":"{{#=}}{{mergedSprintsListSum}}-{{fromListSum}}{{/}}"},"lazy":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623850","component":"ACTION","parentId":null,"conditionParentId":null,"schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702463652061","name":{"type":"FREE","value":"checkAdd"},"type":"SMART","query":{"type":"SMART","value":"{{#=}}{{toListSize}}-{{fromListSize}}{{/}}"},"lazy":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623851","component":"ACTION","parentId":null,"conditionParentId":null,"schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702463716250","name":{"type":"FREE","value":"checkRemove"},"type":"SMART","query":{"type":"SMART","value":"{{#=}}{{fromListSize}}-{{toListSize}}{{/}}"},"lazy":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623852","component":"BRANCH","parentId":null,"conditionParentId":null,"schemaVersion":1,"type":"jira.issue.related","value":{"relatedType":"current","jql":"","linkTypes":[],"onlyUpdatedIssues":false,"similarityLimit":40,"compareValue":0},"children":[{"id":"379623853","component":"CONDITION","parentId":"379623852","conditionParentId":null,"schemaVersion":1,"type":"jira.comparator.condition","value":{"first":"{{checkAdd}}","second":"-1","operator":"GREATER_THAN"},"children":[],"conditions":[],"connectionId":null},{"id":"379623854","component":"ACTION","parentId":"379623852","conditionParentId":null,"schemaVersion":1,"type":"jira.issue.outgoing.webhook","value":{"url":"https://jhnnym.atlassian.net/rest/agile/1.0/sprint/{{currentSprintID}}","headers":[{"id":"_header_1704525058207","name":"Authorization","value":"**************************","headerSecure":true}],"sendIssue":false,"contentType":"empty","customBody":null,"method":"GET","responseEnabled":true,"continueOnErrorEnabled":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623855","component":"ACTION","parentId":"379623852","conditionParentId":null,"schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702251014615","name":{"type":"FREE","value":"currentSprintState"},"type":"SMART","query":{"type":"SMART","value":"{{webhookResponse.body.state}}"},"lazy":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623856","component":"CONDITION","parentId":"379623852","conditionParentId":null,"schemaVersion":1,"type":"jira.comparator.condition","value":{"first":"{{currentSprintState}}","second":"active","operator":"EQUALS"},"children":[],"conditions":[],"connectionId":null},{"id":"379623857","component":"ACTION","parentId":"379623852","conditionParentId":null,"schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702469748807","name":{"type":"FREE","value":"sprintName"},"type":"SMART","query":{"type":"SMART","value":"{{webhookResponse.body.name}}"},"lazy":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623858","component":"ACTION","parentId":"379623852","conditionParentId":null,"schemaVersion":1,"type":"jira.issue.outgoing.webhook","value":{"url":"https://webhook.site/c1df6916-2311-4fd6-a2e9-67cf3332aebe","headers":[{"id":"_header_1704535785066","name":"","value":"","headerSecure":false}],"sendIssue":false,"contentType":"custom","customBody":"{{now .convertToTimeZone(\"America/Los_Angeles\").longDateTime}}:\nAdded {{issue.key}} to active sprint '{{sprintName}}'\n\nOld Issue Sprint: '[{{fieldChange.fromString}}]'\nNew Issue Sprint: '[{{fieldChange.toString}}]'\n","method":"POST","responseEnabled":false,"continueOnErrorEnabled":false},"children":[],"conditions":[],"connectionId":null}],"conditions":[],"connectionId":null},{"id":"379623859","component":"CONDITION","parentId":null,"conditionParentId":null,"schemaVersion":1,"type":"jira.condition.container.block","value":null,"children":[{"id":"379623860","component":"CONDITION_BLOCK","parentId":"379623859","conditionParentId":null,"schemaVersion":1,"type":"jira.condition.if.block","value":{"conditionMatchType":"ALL"},"children":[{"id":"379623862","component":"ACTION","parentId":"379623860","conditionParentId":null,"schemaVersion":1,"type":"jira.issue.outgoing.webhook","value":{"url":"https://jhnnym.atlassian.net/rest/agile/1.0/sprint/{{previousSprintID}}","headers":[{"id":"_header_1704529322839","name":"Authorization","value":"**************************","headerSecure":true}],"sendIssue":false,"contentType":"empty","customBody":null,"method":"GET","responseEnabled":true,"continueOnErrorEnabled":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623863","component":"ACTION","parentId":"379623860","conditionParentId":null,"schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1701947930023","name":{"type":"FREE","value":"previousSprintState"},"type":"SMART","query":{"type":"SMART","value":"{{webhookResponse.body.state}}"},"lazy":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623864","component":"CONDITION","parentId":"379623860","conditionParentId":null,"schemaVersion":1,"type":"jira.comparator.condition","value":{"first":"{{previousSprintState}}","second":"active","operator":"EQUALS"},"children":[],"conditions":[],"connectionId":null},{"id":"379623865","component":"ACTION","parentId":"379623860","conditionParentId":null,"schemaVersion":1,"type":"jira.create.variable","value":{"id":"_customsmartvalue_id_1702469652306","name":{"type":"FREE","value":"sprintName"},"type":"SMART","query":{"type":"SMART","value":"{{webhookResponse.body.name}}"},"lazy":false},"children":[],"conditions":[],"connectionId":null},{"id":"379623866","component":"ACTION","parentId":"379623860","conditionParentId":null,"schemaVersion":1,"type":"jira.issue.outgoing.webhook","value":{"url":"https://webhook.site/c1df6916-2311-4fd6-a2e9-67cf3332aebe","headers":[{"id":"_header_1704535837538","name":"","value":"","headerSecure":false}],"sendIssue":false,"contentType":"custom","customBody":"{{now.convertToTimeZone(\"America/Los_Angeles\").longDateTime}}:\nRemoved issue {{issue.key}} from active sprint '{{sprintName}}'\n\nIssue Sprint:  '[{{issue.sprint}}]'\nprevious sprint state: '{{previousSprintState}}'\n\nfieldChange.from : '{{fieldChange.fromString}}'\nfieldChange.to : '{{fieldChange.toString}}'\n","method":"POST","responseEnabled":false,"continueOnErrorEnabled":false},"children":[],"conditions":[],"connectionId":null}],"conditions":[{"id":"379623861","component":"CONDITION","parentId":null,"conditionParentId":"379623860","schemaVersion":1,"type":"jira.comparator.condition","value":{"first":"{{checkRemove}}","second":"-1","operator":"GREATER_THAN"},"children":[],"conditions":[],"connectionId":null}],"connectionId":null}],"conditions":[],"connectionId":null}],"canOtherRuleTrigger":false,"notifyOnError":"NEVER","projects":[],"labels":[],"tags":[{"id":54020255,"tagType":"IS_RULE_UPDATED","tagValue":"true"}],"ruleScope":{"resources":["ari:cloud:jira::site/d09e9e5a-a9d2-4a40-aa41-bd39061e4d35"]},"ruleHome":{"ruleLifecycleHome":{"locationARI":"ari:cloud:jira-software::site/d09e9e5a-a9d2-4a40-aa41-bd39061e4d35"},"ruleBillingHome":{"locationARI":"ari:cloud:jira-software::site/d09e9e5a-a9d2-4a40-aa41-bd39061e4d35"}},"writeAccessType":"UNRESTRICTED","collaborators":[],"billingType":"NORMAL"}]}